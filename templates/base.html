<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Research Assistant{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="top-nav">
        <a href="/" class="nav-brand">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Research Assistant logo" class="nav-icon" height="32">
            Research Assistant
        </a>
    </nav>

    <div class="layout">
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>

        <aside class="sidebar">
            <a href="/" class="sidebar-new-btn">+ New Research</a>
            <h3 class="sidebar-heading">History</h3>
            <ul class="history-list" id="historyList">
                {% for item in history %}
                <li class="history-item {% if request.path == '/results/' + item.id %}active{% endif %}">
                    <a href="/results/{{ item.id }}" class="history-link">
                        <span class="history-question">{{ item.question[:60] }}{% if item.question|length > 60 %}...{% endif %}</span>
                        <span class="history-meta">
                            {{ item.num_comments or 0 }} comments
                            &middot;
                            {{ item.created_at[:10] }}
                        </span>
                    </a>
                    <button class="btn-archive-sidebar" onclick="showArchiveConfirm('{{ item.id }}', event)" title="Archive">&times;</button>
                </li>
                {% else %}
                <li class="history-empty">No research history yet</li>
                {% endfor %}
            </ul>
            <button class="sidebar-archived-btn" onclick="openArchivedPopup()">Archived Research</button>
        </aside>
    </div>

    <!-- Archive Confirm Popover -->
    <div id="archiveConfirm" class="archive-confirm-popover" style="display:none;">
        <p>Archive this research?</p>
        <div class="archive-confirm-actions">
            <button class="btn btn-sm btn-danger" id="archiveConfirmYes">Archive</button>
            <button class="btn btn-sm btn-outline" onclick="hideArchiveConfirm()">Cancel</button>
        </div>
    </div>

    <!-- Archived Research Popup -->
    <div id="archivedOverlay" class="archived-overlay" onclick="closeArchivedPopup()" style="display:none;">
        <div class="archived-popup" onclick="event.stopPropagation()">
            <div class="archived-popup-header">
                <h3>Archived Research</h3>
                <span class="archived-popup-close" onclick="closeArchivedPopup()">&times;</span>
            </div>
            <div class="archived-popup-body" id="archivedList">
                <p style="color:#7c7c7c;">Loading...</p>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
